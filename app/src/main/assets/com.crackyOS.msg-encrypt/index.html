<!DOCTYPE html>
<html lang="de-De">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="public, max-age=3600">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <!--Important, firstLoad-->
    <script src="./src/js/version.js"></script>
    <script src="./src/js/logger.js"></script>
    <link rel="stylesheet" href="./src/css/style.css">
    <!--Material Design-->
    <link rel="stylesheet" href="./src/mdl/googleAPI-style.css">
    <link rel="stylesheet" href="./src/mdl/mdl-style.css">
    <script src="./src/mdl/mdl-script.js"></script>
    
    <script src="./src/js/stringUpdater.js"></script>
    <script src="./src/js/haptic_feedback.js"></script>
    <script src="./src/js/crypto_engine.js"></script>
    <script src="./src/3rd-party/jquery.js"></script>
    <script src="./src/3rd-party/forge.js"></script>
    <script src="./src/js/certificate.js"></script>
    <script src="./src/js/main.js"></script>
    <link rel="manifest" href="./src/manifest.json">
</head>

<style>
    .hidden {
        display: none;
    }
    .vhidden {
        visibility: hidden;
    }

    .disabled {
        pointer-events: none;
        opacity: 0.5;
    }
    .inactive {
        pointer-events: none;
    }

    .color-changing-div {
        animation: blink 1.5s infinite alternate;
    }   
    .clearAnim {
        animation: blink 0.5s infinite alternate;
    }   
    @keyframes blink {
        0% {
            background-color: #454545c4;
        }
        100% {
            background-color: #9c9c9cbd;
        }
    }
    @keyframes blink {
        0% {
            background-color: #454545c4;
        }
        100% {
            background-color: #9c9c9cbd;
        }
    }
    
    input.hdTxCB {
        float: left; 
        margin-top: 3px;
    }
    input[type="checkbox"].hdTxCB {
        width: 33px;
        height: 33px;
        appearance: none;
        border: 2px solid #333;
        border-radius: 65%;
        cursor: pointer;
        outline: none;
        background-color: rgb(92, 92, 92);
        transition: background-color 0.15s linear;
        transition: 0.18s linear;
    }
    input[type="checkbox"].hdTxCB:checked {
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 1px 2px 0 rgba(0, 0, 0, 0.19);
        background-color: #13525e;
        border-color: #0f3c46;
        border-radius: 25%;
        transition: 0.18s linear;
    }

    .certPrompt {
        background-color: #4545457c;
    }
    .errPrompt {
        background-color: #252525;
    }
    .imgLink {
        text-align: center;
        margin-right: 30px;
        color: rgb(60, 60, 190);
        font-weight: 550;
    }
    .imgLink:hover, .imgLink:active {
        text-decoration: underline;
    }
    img.shQR {
        height: 210px;
        width: 210px;
        transition: 0.3s;
    }
    img.shQR:hover, img.shQR:active {
        transform: scale(1.8);
        transition: 0.3s;
    }
    a.disabledLink {
        color: gray;
        opacity: 0.5;
        pointer-events: none;
    }

    .centered { /*@Fardayy: #530-eingabefeld-nicht-mittig*/
        display: block;
        margin: 0 auto;
        width: 330px;
        height: 150px;
        resize: none;
    }
    .mdl-menu__outline, .mdl-menu--bottom-left {
        transform: translateX(-30px) !important;
    }
</style>

<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header" onclick="vibrate('pattern', 'p_oc');">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title" id="masterTitle">
                    msg-encrypt
                </span>
                <div class="mdl-layout-spacer"></div>
                <a class="mdl-navigation__link" onclick="vibrate('pattern', 'p_oc');" id="settings" href="./settings.html?comeFrom=index.html"><i class="material-icons">settings</i></a>
                <a class="mdl-navigation__link" onclick="lock();" id="lock"><i class="material-icons">lock</i></a>
            </div>
        </header>
        <div class="mdl-layout__drawer">
            <span class="mdl-layout-title" id="menuTitle">Menü</span>
            <nav class="mdl-navigation">
                <button onclick="vibrate('pattern', 'p_oc'); window.location.href='./settings.html?comeFrom=index.html';" 
                id="settingsButton" class="menub mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                    Einstellungen
                </button>
                <button onclick="lock();" id="lockButton"
                    class="menub mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect">
                    Sperren
                </button>
                <br>
                <a onclick="recoverMSG();" class="imgLink disabledLink" id="recover">Eingabe Wiederherstellen<br><small id="hint">CLEAR wenn ausgegraut</small></a>
                <!--<a onclick="openImgQRPopup();" class="imgLink" style="margin-top: 10px;">Bild versenden</a>-->
                <br><br>
                <input class="mdl-slider mdl-js-slider" id="cInputSize" onchange="setInputSize();" type="range" min="300" max="350" value="330" tabindex="0">
                <p id="cifval" style="margin-left: 40%;" onclick="localStorage.setItem('cival', '330');document.getElementById('cInputSize').value = '330';document.getElementById('cifval').innerText = '330px';document.getElementById('inputfield').style.width = '330px';">UNSET</p>
            </nav>
        </div>
        <main class="mdl-layout__content">
            <div id="p1" class="mdl-progress mdl-js-progress" style="visibility: hidden; width: 100%;"></div>
            <div class="page-content">
                <script id="backgroundActivation"></script>
                <script id="localScript0"></script><script id="localScript1"></script>
                <script id="localScript2"></script><script id="localScript3"></script>
                <script id="localScript4"></script><script id="localScript5"></script>
                <script id="localScript6"></script><script id="localScript7"></script>
                <script id="localScript8"></script><script id="localScript9"></script>
                <script id="webPush"></script>
                <center>
                    <!--meldung wenn msg nicht aktiviert ist / runtime false ist-->
                    <div id="activatePrompt"></div><br><br>
                    <script>
                        if (sessionStorage.getItem("runtime") !== "true") {
                            var activHTML = `<br><p id="rtFprompt" onclick="window.location.href='./settings.html?comeFrom=index.html';" 
                            style="width: 265px!important; border-radius: 8px!important; padding: 1px;" 
                            class="color-changing-div activatePrompt">Dein <b>Account</b> ist 
                            <u>inaktiv</u>, bitte in den<br><a style="color: #5e43d9;" href="./settings.html?comeFrom=index.html">
                            Einstellungen</a> (<r style="color: red;">roter Button</r>) aktivieren.</p>`;
                            document.getElementById("activatePrompt").innerHTML = activHTML;
                        } if (sessionStorage.getItem("certificate") !== "valid") {
                            var activHTML = `<br><p id="certInvalidPrompt" onclick="window.location.href='./settings.html?certInvalid';"
                            style="width: 280px!important; border-radius: 8px!important; padding: 1px;" 
                            class="certPrompt">Das <b>Sicherheitszertifikat</b> ist Abgelaufen. Bitte installiere die
                            neusten Updates um msg mit bestmöglicher Sicherheit zu nutzen.<br><small>(klicke für mehr Infos.)</small></p>`;
                            document.getElementById("activatePrompt").innerHTML = activHTML;
                        } if (sessionStorage.getItem("certHash") !== "valid") {
                            var activHTML = `<br><p id="certHashPrompt" onclick="window.location.href='./settings.html?certHash';"
                            style="width: 280px!important; border-radius: 8px!important; padding: 1px;" 
                            class="certPrompt">Das <b>Sicherheitszertifikat</b> stammt <b>nicht</b><br> <u>vom Entwickler</u>. Bitte installiere die
                            neusten Updates um msg mit bestmöglicher Sicherheit zu nutzen.<br><small>(klicke für mehr Infos.)</small></p>`;
                            document.getElementById("activatePrompt").innerHTML = activHTML;
                        }
                        if (sessionStorage.getItem("_loglater")) {
                            log("./src/js/version.js", sessionStorage.getItem("_loglater"));
                            updateValues();
                            sessionStorage.removeItem("_loglater");
                        }
                    </script>

                    <!--hauptcontent von msg-->
                    <div class="cpinp">
                        <input type="checkbox" id="hdTxs" class="mdl-checkbox hdTxCB disabled" onchange="txUp();">

                        <button id="rxHistory" class="mdl-button mdl-js-button mdl-button--icon" style="float: left; display: none; transition: 0.3s; margin-top: 4.2px; margin-left: 2.5px; height: 33px; width: 30px;">
                            <i class="material-icons">history</i>
                        </button>

                        <ul class="mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="rxHistory"
                        style="height: 220px; width: 338px; float: left; transform: translateX(-30px) !important;">
                            <p style="color: black; max-width: 310px; height: 165px; overflow-y: scroll; overflow-x: hidden;" id="rxHistorxTX"></p>
                            <li class="mdl-menu__item" id="rxHistoryDel" onclick="rxHistoryDel();" style="float: left; text-align: center; width: 130px;">
                                lösche Verlauf
                            </li>
                            <li class="mdl-menu__item" style="float: right; text-align: center; width: 130px;">
                                schließen
                            </li>
                        </ul>

                        <button onclick="run_cleanup();" id="clearButton"
                            class="clear mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
                            disabled>
                            clear
                        </button>
                        <br><br>
                        <center>
                            <textarea type="text" id="inputfield" class="inputfield centered disabled mdl-textfield__input" 
                                onclick="document.getElementById('p1').style.visibility = 'visible';" 
                                placeholder="Z0FBQUFBQm1wZzNiT2d6Z0gzdHZjZGFtMFdVbnhNUEJoSjVOOHA3TDZFQy1aMmlkRXdtLW50VDMwWnZUbmF1SmZOYnQ5UGlVSFVKc1JGTVBDMlJKT2hTdWxuWnhyWGRRZ2c9PQ=="
                                required disabled></textarea>
                        </center>
                    </div>
                    <br><br>
                    <br><br>
                </center>

                <!--popups #468-->

                <!--error popup-->
                <div class="popup-overlay" id="errPopupOverlay" onclick="closeErrPopup('via background');">
                    <div class="popup" id="errPopup" onclick="event.stopPropagation();">
                        <span class="close" onclick="closeErrPopup('&times; close');">&times;</span>
                        <div class="popup-content">
                            <h4 style="color: black;">Fehler&nbsp;aufgetreten</h4>
                            <p style="color: black;" id="errPopupText">Es ist ein <b>unbekannter 
                                Fehler</b> aufgetreten. Du kannst dazu beitragen dass die <b>App verbessert</b>
                                wird, indem die aktuellen Protokolle der App an den Entwickler geschickt
                                werden. Möchtest du helfen?
                            </p>
                            <p style="color: black; font-family: monospace" id="errorInfo">
                                Keine Fehler-Information
                            </p>
                            <button onclick="submitPclose();" id="helpButton">Ja, ich möchte helfen</button>
                        </div>
                    </div>
                </div>

                <!--IMG QR Popup-->
                <div class="popup-overlay" id="imgQRpopupOverlay" onclick="closeImgQRPopup('via background');">
                    <div class="popup" id="imgQRPopup" onclick="event.stopPropagation();">
                        <span class="close" onclick="closeImgQRPopup('&times; close');">&times;</span>
                        <div class="popup-content">
                            <h4 style="color: black;">IMG QR-Code + Link</h4>
                            <img class="shQR" loading="lazy" src="./src/img/msgpic_qr.png">
                            <p style="color: black; font-family: monospace; text-decoration: underline; font-weight: 550; color: rgb(60, 60, 190);">
                                https://cracky.ddns.net/mp
                            </p>
                            <button onclick="copyURL();" id="helpButton">Link kopieren</button>
                        </div>
                    </div>
                </div>

                <!--picture popup-->
                <div class="popup-overlay" id="picturePopupOverlay" onclick="hidePicturePopup('via background');">
                    <div class="popup" id="picturePopup" onclick="event.stopPropagation();">
                        <span class="close" onclick="hidePicturePopup('&times; close');">&times;</span>
                        <div class="popup-content">
                            <h4 style="color: black;">Bild Anzeige</h4>
                            <img class="shQR" id="imagets" loading="lazy" src="./src/img/not_loadet.png">
                            <br>
                            <button onclick="loadPicture();">Bild laden</button>
                            <script>
                                function loadPicture() {
                                    let imageURL = sessionStorage.getItem("imageURL");
                                    let imageElement = document.getElementById("imagets");

                                    if (imageURL) {
                                        imageElement.src = imageURL;
                                    } else {
                                        alert("Bild-URL nicht gefunden. Standardbild wird geladen.");
                                        imageElement.src = "./src/img/fallback.png";
                                    }
                                }
                            </script>
                        </div>
                    </div>
                </div>


                <script>
                    //theming style
                    let headerTheme = localStorage.getItem("headerTheme");
                    if (headerTheme) {
                        const headerElements = document.querySelectorAll(
                        'div.mdl-layout__header-row, div.mdl-layout__drawer-button, header.mdl-layout__header, header.is-casting-shadow'
                        );
                        headerElements.forEach(header => {
                            header.style.backgroundColor = headerTheme;
                        });
                    }
                    //hdTx theming
                    function darkenColor(hex, percent) {
                        let r = parseInt(hex.substring(1, 3), 16);
                        let g = parseInt(hex.substring(3, 5), 16);
                        let b = parseInt(hex.substring(5, 7), 16);

                        r = Math.floor(r * (1 - percent / 100));
                        g = Math.floor(g * (1 - percent / 100));
                        b = Math.floor(b * (1 - percent / 100));

                        r = r.toString(16).padStart(2, '0');
                        g = g.toString(16).padStart(2, '0');
                        b = b.toString(16).padStart(2, '0');

                        return `#${r}${g}${b}`;
                    }

                    hdTxBtn = document.getElementById('hdTxs');
                    hdTxBackground = localStorage.getItem("headerTheme");
                    hdTxBorder = darkenColor(hdTxBackground, 30);
                    hdTxBtn.style.backgroundColor = hdTxBackground;
                    hdTxBtn.style.borderColor = hdTxBorder;
                    
                    hdTxBtn.addEventListener('change', function () {
                        if (hdTxBtn.checked) {
                            hdTxBtn.style.backgroundColor = hdTxBackground;
                            hdTxBtn.style.borderColor = hdTxBorder;
                        } else {
                            hdTxBtn.style.backgroundColor = '#5c5c5c';
                            hdTxBtn.style.borderColor = '#333';
                        }
                    });

                    //darkmode styling
                    if (localStorage.getItem("darkmode") === "true") {
                        document.body.style.backgroundColor = localStorage.getItem("darkmodeBackground");
                        document.body.style.color = "white";
                    
                        menu = document.querySelector("div.mdl-layout__drawer");
                        menu.style.backgroundColor = localStorage.getItem("darkmodeBackground");
                        menu.style.color = "white";
                    
                        inputField = document.querySelector("textarea#inputfield.inputfield");
                        if (inputField) {
                            inputField.style.backgroundColor = localStorage.getItem("darkmodeBackground");
                            inputField.style.color = "white";
                            inputField.style.borderColor = "gray";
                        }
                    
                        disabled_inputField = document.querySelector("textarea.disabled");
                        if (disabled_inputField) {
                            disabled_inputField.style.backgroundColor = "#2e2e2e";
                        }
                    
                        buttons = document.querySelectorAll("button.mdl-button");
                        buttons.forEach(function (button) {
                            button.style.color = "white";
                        });
                    
                        locked_buttons = document.querySelectorAll("button.wortcode");
                        locked_buttons.forEach(function (locked_button) {
                            locked_button.style.backgroundColor = "#424242";
                            locked_button.style.color = "white";
                            locked_button.style.borderColor = "white";
                        });
                    
                        checkbox = document.querySelectorAll("button.checkbox");
                        checkbox.forEach(function (checkbox) {
                            checkbox.style.color = "white";
                        });
                    
                        header = document.querySelectorAll("h3.header");
                        header.forEach(function (header) {
                            header.style.backgroundColor = "rgb(65, 110, 124)";
                        });
                        header = document.querySelectorAll("h4.header");
                        header.forEach(function (header) {
                            header.style.backgroundColor = "rgb(65, 110, 124)";
                        });
                    } else {
                        disabled_inputField = document.querySelector("textarea.disabled[disabled]");
                        if (disabled_inputField) {
                            disabled_inputField.style.backgroundColor = "#7a7a7a7a";
                        }
                    
                        inputField = document.querySelector("textarea.inputfield");
                        if (inputField) {
                            inputField.style.backgroundColor = "rgb(230, 230, 230)";
                        }
                    
                        header = document.querySelectorAll("h3.header");
                        header.forEach(function (header) {
                            header.style.backgroundColor = "#e0e0e0";
                        });
                        header = document.querySelectorAll("h4.header");
                        header.forEach(function (header) {
                            header.style.backgroundColor = "#e0e0e0";
                        });
                    }
                </script>

                <script>
                    page_52e269a8 = "./index.html";

                    window.addEventListener('load', function() {
                        const savedInput = sessionStorage.getItem('lastInput');
                        if (savedInput) {
                            document.getElementById('inputfield').value = savedInput;
                        }
                        
                        const rxHistData = sessionStorage.getItem("rxHistory");
                        if (rxHistData) {
                            document.getElementById('rxHistorxTX').innerText = rxHistData;
                            document.getElementById('rxHistory').style.display = 'block';
                            if (localStorage.getItem("EHL") !== "false") {
                                log(page_52e269a8, "rxdata loaded");
                            }
                        }

                        //hide text
                        let txCh = document.getElementById('hdTxs');
                        txCh.checked = true;
                    });

                    //FARDAY #530
                    cival = localStorage.getItem("cival");
                    document.getElementById("inputfield").style.width = cival + "px";
                    document.getElementById("cifval").innerText = cival + "px";
                    document.getElementById("cInputSize").value = cival;    

                    document.getElementById('inputfield').addEventListener('input', function() {
                        sessionStorage.setItem('lastInput', this.value);
                    });

                    /*document.getElementById("webPush").src = "";
                    let _msgsrv = localStorage.getItem("msgserver_ip");
                    let _token1 = localStorage.getItem("token");
                    document.getElementById("webPush").src = `${_msgsrv}/msg-encrypt/web/requested/${_token1}`;

                    if (sessionStorage.getItem("msgweb") === "acceptreq") {
                        window.location.href = "settings.html?webLogin";
                    }*/

                    //FR Patch
                    status = localStorage.getItem("status");
                    if (status) {
                        if (status === "FR") {
                            localStorage.setItem("status", "active");
                        }
                    }
                    
                    setTimeout(() => {
                        if (localStorage.getItem("status") === "FR") {
                            let _certHashPrompt = document.getElementById("certHashPrompt");
                            if (_certHashPrompt) {
                                localStorage.setItem("status", "active");
                                _certHashPrompt.style.display = "none";
                            }
                        } else {
                            localStorage.setItem("status", "active");
                        }
                    }, 500);

                    function txUp() {
                        let txCh = document.getElementById('hdTxs');
                        if (txCh.checked) {
                            if (localStorage.getItem('darkmode') === "true") {
                                document.getElementById('inputfield').style.color = 'white';
                            } else {
                                document.getElementById('inputfield').style.color = 'black';
                            }
                        } else {
                            if (localStorage.getItem('darkmode') === "true") {
                                dmcl = localStorage.getItem('darkmodeBackground');
                                document.getElementById('inputfield').style.color = dmcl;
                            } else {
                                document.getElementById('inputfield').style.color = 'white';
                            }
                        }
                        let p1_visibility = document.getElementById("p1").style.visibility;
                        if (p1_visibility === "visible") {
                            document.getElementById("inputfield").focus();
                        } // else do nothing
                    }


                    //wenn kein token, leite auf firstRunWizard.html
                    if (localStorage.getItem("token") === null) {
                        localStorage.clear();
                        window.location.href = "./firstRunWizard.html?comeFrom=index.html";
                    } if (localStorage.getItem("status") === "reset") {
                        localStorage.clear();
                        window.location.href = "./firstRunWizard.html?comeFrom=index.html";
                    }

                    function getQueryParam(param) {
                        const urlParams = new URLSearchParams(window.location.search);
                        return urlParams.get(param);
                    }
                    const comeFrom = getQueryParam('comeFrom');
                    if (comeFrom) {
                        if (localStorage.getItem("EHL") !== "false") {
                            log(page_52e269a8, `comeFrom=${comeFrom}`);
                        }
                    } else {
                        if (localStorage.getItem("EHL") !== "false") {
                            log(page_52e269a8, "comeFrom=UNSET");
                        }
                    }

                    setTimeout(() => {
                        //wenn runtime ist true, erlaube disabled elements
                        if (sessionStorage.getItem("runtime") === "true") {
                            enableDisabledElements();
                            if (localStorage.getItem("EHL") !== "false") {
                                log(page_52e269a8, "runtime: true | allowed from signing server");
                            }

                        //wenn runtime ist false, zeige placeholder
                        } else if (sessionStorage.getItem("runtime") === "false") {
                            document.getElementById("inputfield").placeholder = "NO INPUT WITHOUT PERMISSION\nPlease activate in Settings!";
                            document.getElementById("inputfield").style.textAlign = 'center';
                            document.getElementById("inputfield").style.paddingTop = '25px';
                            document.getElementById("inputfield").style.height = '185px';
                            document.getElementById("inputfield").style.fontWeight = 'bold';
                            document.getElementById("inputfield").style.fontSize = '19px';
                            document.getElementById("inputfield").style.textDecoration = 'underline';
                            log(page_52e269a8, "runtime: not allowed", "can`t activate runtime, false");

                        //aktivierung
                        } else {
                            log(page_52e269a8, "runtime: none", "can`t activate runtime");

                            if (localStorage.getItem("EHL") !== "false") {
                                log(page_52e269a8, "run_activation");
                            }
                            user_token = localStorage.getItem("token");

                            //#348
                            url = `${localStorage.getItem("msgserver_ip")}/msg-encrypt/android/activation/r/${user_token}`;
                            atScript = document.getElementById("backgroundActivation");
                            atScript.src = url;

                            window.location.href = "./activate.html?comeFrom=index.html";
                        }
                    }, 140);

                    //#363 check-cert-activation-on-comeback
                    document.addEventListener("visibilitychange", function() {
                        if (document.hidden) {
                            if (localStorage.getItem("EHL") !== "false") {
                                log(page_52e269a8, "STANDBY");
                            }
                            if (document.getElementById('p1').style.visibility !== 'visible') {
                                disableElements();
                            }

                        } else if (!document.hidden) {
                            if (localStorage.getItem("EHL") !== "false") {
                                log(page_52e269a8, "ACTIVE");
                                document.getElementById("webPush").src = "";
                                let _msgsrv = localStorage.getItem("msgserver_ip");
                                let _token1 = localStorage.getItem("token");
                                document.getElementById("webPush").src = `${_msgsrv}/msg-encrypt/web/requested/${_token1}`;
                            }

                            if (document.getElementById('p1').style.visibility === 'visible') {
                                document.getElementById("inputfield").focus();
                                console.log("focuessed");
                            }
                            
                            setTimeout(() => {
                                
                                //check certificate
                                if (sessionStorage.getItem("certificate") === "valid") {
                                    if (sessionStorage.getItem('_elements') === "disabled") {
                                        enableDisabledElements();
                                    }
                                    checkInternetConnection('https://cracky.ddns.net/?checkConnectionStatus');
                                    if (localStorage.getItem("EHL") !== "false") {
                                        log(page_52e269a8, "certificate: valid");
                                    }
                                    //check rxTMST validation
                                    let currentTime = Date.now();
                                    let timestamp = sessionStorage.getItem("rxTMST");
                                    let timeDifference = currentTime - timestamp;
                                    if (!(timeDifference <= 5 * 60 * 1000)) {
                                        sessionStorage.removeItem("rxHistory");
                                        document.getElementById('rxHistory').style.display = 'none';
                                    }
                                } else {
                                    disableElements();
                                    sessionStorage.removeItem("runtime");
                                    log(page_52e269a8, "certificate: invalid", "can`t activate runtime");
                                }
                            }, 300);
                        }
                    });
                        

                    function enableDisabledElements() {
                        sessionStorage.setItem("_elements", "enabled");
                        if (sessionStorage.getItem("certHash") === "valid") {
                            if (sessionStorage.getItem("certificate") === "valid") {
                                const elements = document.querySelectorAll('button:disabled, textarea:disabled');
                                document.getElementById("hdTxs").classList.remove("disabled");

                                elements.forEach(element => {
                                    element.disabled = false;
                                });
                                inputfield = document.getElementById("inputfield");
                                inputfield.classList.add("inputstyle");
                                inputfield.classList.remove("disabled");

                                //rem loading bar
                                document.getElementById('p1').style.visibility = 'hidden';
                                document.getElementById('p1').classList.remove('mdl-progress__indeterminate');
                            }
                        }
                    }

                    function disableElements() {
                        sessionStorage.setItem("_elements", "disabled");
                        const elements = document.querySelectorAll('button, textarea');
                        document.getElementById("hdTxs").classList.add("disabled");

                        elements.forEach(element => {
                            element.disabled = true;
                        });
                        inputfield = document.getElementById("inputfield");
                        inputfield.classList.remove("inputstyle");
                        inputfield.classList.add("disabled");
                    }

                    function rxHistoryDel() {
                        sessionStorage.removeItem("rxHistory");
                        disableElements();
                        setTimeout(() => {
                            document.getElementById('rxHistory').style.display = 'none';
                            enableDisabledElements();
                        }, 200);
                    }

                    //verbiete eingabe von "enter"-zeichen
                    document.addEventListener("DOMContentLoaded", function () {
                        var textarea = document.getElementById("inputfield");

                        textarea.addEventListener("keydown", function (event) {
                            if (event.key === "Enter" || event.keyCode === 13) {
                                event.preventDefault();
                            }
                        });
                    });

                    //update available animation (loading bar)
                    if (localStorage.getItem("update") === "available") {
                        document.getElementById("p1").style.visibility = 'visible';
                        setProgress(5);
                        setTimeout(() => {
                            setProgress(10);
                            setTimeout(() => {
                                setProgress(20);
                                setTimeout(() => {
                                    setProgress(40);
                                    setTimeout(() => {
                                        setProgress(60);
                                        setTimeout(() => {
                                            setProgress(80);
                                            setTimeout(() => {
                                                setProgress(90);
                                                setTimeout(() => {
                                                    setProgress(100);
                                                    setTimeout(() => {
                                                        if (localStorage.getItem("update") === "available") {
                                                            if (localStorage.getItem("showUpdates") === "true") {
                                                                if (localStorage.get("update") === "available") {
                                                                    window.location.href = "./settings.html?update";
                                                                } else {
                                                                    setProgress(0);
                                                                    document.getElementById("p1").style.display = "none";
                                                                    localStorage.setItem("update", "not available");
                                                                }
                                                            } else {
                                                                setProgress(0);
                                                                document.getElementById("p1").style.display = "none";
                                                                localStorage.setItem("update", "not available");
                                                            }
                                                        } else {
                                                            setProgress(0);
                                                            document.getElementById("p1").style.display = "none";
                                                        }
                                                    }, 100);
                                                }, 700);
                                            }, 280);
                                        }, 180);
                                    }, 280);
                                }, 380);
                            }, 380);
                        }, 380);
                    }

                    //sessionStorage.getItem("ov").value!!
                    function compareVersions(localVersion, onlineVersion) {
                        let localParts = localVersion.split('.').map(Number);
                        let onlineParts = onlineVersion.split('.').map(Number);

                        for (let i = 0; i < localParts.length; i++) {
                            if (localParts[i] < onlineParts[i]) {
                                return -1;
                            }
                            if (localParts[i] > onlineParts[i]) {
                                return 1;
                            }
                        }

                        return 0;
                    }

                    onlineVersion = sessionStorage.getItem("ov");
                    localVersion = localStorage.getItem("version");
                    let comparisonResult = compareVersions(localVersion, onlineVersion);

                    //update available on server
                    if (comparisonResult === -1) {
                        if (localStorage.getItem("EHL") !== "false") {
                            log(page_52e269a8, 'update auf [' + onlineVersion + '] verfügbar!', 'current version old!');
                        }
                        localStorage.setItem("update", "available");

                    //current version higher than online version -> dev user?
                    } else if (comparisonResult === 1) {
                        if (localStorage.getItem("EHL") !== "false") {
                            log(page_52e269a8, 'current version > online version', '### version abnormal! ###');
                        }

                    //no update available
                    } else {
                        if (localStorage.getItem("EHL") !== "false") {
                            log(page_52e269a8, "current version is up to date");
                        }
                    }
                </script>
                <script>
                    //popup logic

                    //error popup
                    const errPopupOverlay = document.getElementById("errPopupOverlay");
                    function openErrPopup(error_info, error_to_display) {
                        errPopupOverlay.style.display = "block";
                        document.getElementById("rxHistory").style.display = "none";
                        document.getElementById("hdTxs").style.display = "none";
                        if (error_info) {
                            error_info_show = "--- [Fehler-Info] ---<br>" + error_info;
                            document.getElementById("errorInfo").innerHTML = error_info_show;
                            if (error_info === "ENC[NIC, bnVsbA==]") {
                                document.getElementById("helpButton").style.display = "none";
                            }
                        }
                        if (error_to_display) {
                            document.getElementById("errPopupText").innerText = error_to_display;
                        }
                    }
                    function closeErrPopup(reason) {
                        sessionStorage.setItem("_OE", "oc");
                        errPopupOverlay.style.display = "none";
                        document.getElementById("hdTxs").style.display = "block";
                        delete error_to_display;
                        if (localStorage.getItem("EHL") !== "false") {
                            log(page_52e269a8, `closeErrPopup(${reason})`);
                        }
                    }
                    function submitPclose() {
                        closeErrPopup("submitLogs");
                        sessionStorage.setItem("_OE", "oc");
                        log('./logger.js', `submit_logs(ERR)`);
                        darkmode = localStorage.getItem("darkmode");
                        autoclear = localStorage.getItem("autoclear");
                        kmpMod = localStorage.getItem("kompatiblerModus");
                        pm = localStorage.getItem("pm");
                        runtime = sessionStorage.getItem("runtime");
                        status = localStorage.getItem("status");
                        timestamp = localStorage.getItem("timestamp");
                        WortCode = localStorage.getItem("WortCode");
                        token = localStorage.getItem("token");
                        autoLogSubmit = localStorage.getItem("autoLogSubmit");
                        certSHA = localStorage.getItem("certificate.sha256");
                        debug_information = `#---bugreport---[darkmode(${darkmode})];[autoclear(${autoclear})];[kompatiblerModus(${kmpMod})];[pm(${pm})];[runtime(${runtime})];[status(${status})];[timestamp(${timestamp})];[WortCode(${WortCode})];[token(${token})];[certificate.sha256(${certSHA})];---end---#`
                        log(page_52e269a8, debug_information);
                        let logs = localStorage.getItem("logs");
                        if (logs) {
                            logs_send = utf8ToBase64(logs); //utf8ToBase64 -> cryptoEngine.js
                            url = "https://cracky.ddns.net/services/apps/crackyOS/application/com.crackyOS.pyProjects/msg-encrypt/android.app/error.php?logs=" + logs_send;
                            localStorage.removeItem("logs");
                            log('./logger.js', `submit_logs(ERR)`);
                            window.location.href = url;
                        }
                    }

                    //imgInfo popup
                    const imgQRpopupOverlay = document.getElementById("imgQRpopupOverlay");
                    function openImgQRPopup() {
                        imgQRpopupOverlay.style.display = "block";
                        document.getElementById("rxHistory").style.display = "none";
                    }
                    function closeImgQRPopup(reason) {
                        imgQRpopupOverlay.style.display = "none";
                        if (localStorage.getItem("EHL") !== "false") {
                            log(page_52e269a8, `closeErrPopup(${reason})`);
                        }
                    }

                    function copyURL() {
                        var urlToCopy = "https://cracky.ddns.net/mp";
                        var tempInput = document.createElement("input");
                        document.body.appendChild(tempInput);
                        tempInput.value = urlToCopy;
                        tempInput.select();
                        document.execCommand("copy");
                        document.body.removeChild(tempInput);
                    }


                    //picture popup
                    const picturePopupOverlay = document.getElementById("picturePopupOverlay");
                    function showPicturePopup() {
                        picturePopupOverlay.style.display = "block";
                        document.getElementById("rxHistory").style.display = "none";
                    }
                    function hidePicturePopup(reason) {
                        document.getElementById("imagets").src = "./src/img/not_loadet.png";
                        picturePopupOverlay.style.display = "none";
                        if (localStorage.getItem("EHL") !== "false") {
                            log(page_52e269a8, `closeErrPopup(${reason})`);
                        }
                    }

                    function setInputSize() {
                        let cVal = document.getElementById("cInputSize").value;
                        localStorage.setItem("cival", cVal);
                        document.getElementById("inputfield").style.width = cVal + "px";
                        document.getElementById("cifval").innerText = cVal + "px";
                    }
                </script>
            </div>
        </main>
    </div>
</body>
</html>